!function(){function e(){function e(e){e.preventDefault(),mousedown=!0,e.changedTouches&&(e=e.changedTouches[e.changedTouches.length-1]),o=e.pageX,l=e.pageX,s=e.pageY,n=e.pageY}function t(e){e.preventDefault(),l-o>50&&i.date_img_table_right(),o-l>50&&i.date_img_table_left(),mousedown=!1}function a(e){e.preventDefault(),mousedown&&(e.changedTouches&&(e=e.changedTouches[e.changedTouches.length-1]),l=e.pageX,n=e.pageY,$(window).scrollTop($(window).scrollTop()+s-n))}var o,l,s,n;mousedown=!1;var r=document.getElementById("J_show_img_wrap");r.addEventListener("touchstart",e),r.addEventListener("touchend",t),r.addEventListener("touchmove",a)}var t={productList:"/activity/tag/products",recommendList:"/activity/tag/products",grant:"/activity/coupon/grant/normal",bindPhone:"/activity/twoAnn/getTicket ",giftBag:"/activity/twoAnn/coupon/grant",limit:"/activity/seconds/kill",puzzle:"/activity/twoAnn/getUser/tickets"},i={init:function(){var e=this;e.bingo=0,e.blockPuzzleNum=0,e.todayLeftTime=0,e.todayLeftTimeHours=0,e.limitData=[],""==XIANGQU.userId||(e.userCards=userCards||[],e.selfUserCard=selfUserCard),e.J_body=$("body"),e.J_ProductList=$("#selectProductList"),e.J_loadText=document.querySelector("#loadText"),e.J_recommend_wrap=$("#recommendWrap"),e.J_banner_image=document.querySelector("#bannerImage"),e.J_load_wrap=document.querySelector("#loadWrap"),e.myposition=$("#J_con_positioning"),e.bodytop=$("#bannerImage"),e.location1=$("#J_location1"),e.location2=$("#J_location2"),e.location3=$("#J_location3"),e.location4=$("#J_location4"),e.J_error_wrap=$(".J_error_wrap"),e.loginUrl="http://"+window.location.host+"/login/wap/login.html",e.J_giftBag=$("#J_giftBag"),e.currenttime=$("body").attr("data-time"),e.J_date_ul=$(".J_date_ul"),e.J_date_li=$(".J_date_li"),e.J_show_img=$(".J_show_img"),e.J_show_img_wrap=$("#J_show_img_wrap"),e.J_show_img_wrap_post=$(".J_show_img_wrap_post"),e.J_choicenessList=$("#J_choicenessList"),e.J_blockPuzzle=$("#J_blockPuzzle"),e.J_blockPuzzleQ=$("#J_blockPuzzleQ"),e.J_blockPuzzleNum=$("#J_blockPuzzleNum"),e.J_blockPuzzleShare=$("#J_blockPuzzleShare"),e.J_blockPuzzleApp=$("#J_blockPuzzleApp"),e.J_shareOpacity=$("#J_shareOpacity"),e.J_shareOpacityA=$("#J_shareOpacityA"),e.J_blockPuzzleShare.length>0&&(e.storage=window.localStorage),e.J_noticeDiv=$("#J_noticeDiv"),setInterval(function(){e.countdown()},1e3),e.hours=0,e.SMSTimer=null,e.J_detail=$("body"),e.J_bindPhoneBox=e.J_detail.find(".J_bindPhoneBox"),e.initBanner(),e.initUA(),e.initProductAjax(),e.eventHanding(),e.blockPuzzleShare(),e.myyposition(e.myposition),e.ChoicenessListAjax(),e.blockPuzzle(),e.GiftBag()},initBanner:function(){var e=this,t=e.J_banner_image.getAttribute("data-bannerSrc"),i=new Image;i.onload=function(){e.J_banner_image.setAttribute("src",t),e.J_load_wrap.style.display="none"},i.src=t},eventHanding:function(){var t=this;t.J_body.on("tap",".J_product_link",function(){t.productlinkUrl($(this).attr("data-id"))}),t.J_body.on("tap",".J_slide_banner",function(){location.href=$(this).attr("data-url")}),t.countdownstatus(),t.AutoScrollCon(),t.date_tab_change(),e()},initProductAjax:function(){var e=this;e.isOver=!1,e.tags=91,e.activityId=94,e.J_blockPuzzleShare.length>0&&""!==e.storage.sNum&&null!==e.storage.sNum&&void 0!==e.storage.sNum?e.productAjax(parseInt(e.storage.sNum)):e.productAjax(1)},recommendAjax:function(){var e=this,i="";i={activityId:94,excludedTags:"92,93,94,95"},e.midYearAjax(t.recommendList,i,function(t){e.recommendAppend(t)})},recommendAppend:function(e){var t=this,i=template("J_tempRecommendList",{recommendList:e});e&&(t.J_recommend_wrap.append(i),t.initRecommendMsg(),t.bingo=1)},initRecommendMsg:function(){var e=this;e.J_slide_msg_wrap=$(".J_slide_msg_wrap");for(var t=0,i=e.J_slide_msg_wrap.length;t<i;t++)e.J_slide_msg_wrap.eq(t).append(e.J_slide_msg_wrap.eq(t).attr("data-msg"))},productlinkUrl:function(e){var t=this,i="";t.isApp?(i="http://www.xiangqu.com/product/detail?id="+e+"&isApp=1&spm=16.09.22",window.navigator.userAgent.toLocaleLowerCase().indexOf("android")>-1&&(i="xiangqu://"+location.host+"/product/detail?id="+e+"&isApp=1&spm=16.09.22")):i="/product/detail?id="+e+"&spm=16.09.22",location.href=i},initUA:function(){var e=this,t=window.navigator.userAgent.toLocaleLowerCase();t.indexOf("xiangqu")>-1?e.isApp=!0:(e.isH5=!0,t.indexOf("micromessenger")>-1&&(e.isWeix=!0))},productAjaxScroll:function(){var e=this;$(window).bind("scroll",function(){var t=570;t+$(window).scrollTop()>=$(document).height()-$(window).height()&&(e.recommendAjax(),$(window).unbind("scroll"))})},productAjax:function(e){var i=this,a="";i.J_loadText.style.display="block",i.isOver||(i.isOver=!0,a={activityId:i.activityId,tags:e+92+"",shuffle:!0},i.midYearAjax(t.productList,a,function(t){if(!t)return i.J_loadText.style.display="none",i.recommendAjax(),!1;var a=t;i.J_choicenessList.find("li").removeClass("span_border"),1==e?i.J_choicenessList.find("li").eq(0).addClass("span_border"):0==e?i.J_choicenessList.find("li").eq(1).addClass("span_border"):i.J_choicenessList.find("li").eq(e).addClass("span_border"),i.productAppend(i.J_ProductList,a[0].products,function(){i.isOver=!1,i.J_loadText.style.display="none"}),0===i.bingo&&i.productAjaxScroll(),onlazyImg(),i.J_blockPuzzleShare.length>0&&i.commodityPosition()},function(){i.J_loadText.style.display="none"}))},productAppend:function(e,t,i){for(var a="",o=0,l=t.length;o<l;o++)a+='<li> <div class="link-wrap"> <a class="J_product_link" data-id="'+t[o].productId+'"> <img data-src="'+t[o].imgUrl+'"alt=""/></a> </div> <div class="msg-wrap"> <p class="name">'+t[o].title+"</p> ",t[o].originalPrice&&t[o].price!=t[o].originalPrice||(t[o].originalPrice=Math.floor(1.25*t[o].price)),a+='<p class="price">￥'+t[o].price+'<span class="origin-price">原价:<span>'+t[o].originalPrice+"</span></span></p></div> ",a+='<div class="rotate">折扣</div>',a+="</li>";e.html(a),i&&i()},midYearAjax:function(e,t,i,a){var o=this;$.ajax({url:e,type:"post",data:t,dataType:"json",success:function(e){200==e.code?i&&i(e.data):700==e.code?o.error_init(e.msg):alert(e.msg)},complete:function(){a&&a()}})},login:function(){var e=this;""!=e.loginUrl?e.loginUrl.indexOf("http://")>=0?location.href=e.loginUrl+"?redirectUrl="+location.href:location.href=e.loginUrl:e.error_init("请重新登录～")},error_init:function(e){var t=this;t.J_error_wrap.find(".J_error_div").empty().append(e),t.J_error_wrap.css({display:"block"});var i=setInterval(function(){t.J_error_wrap.css({display:"none"}),t.J_error_wrap.find(".J_error_div").empty(),clearInterval(i)},1e3)},scrollAnimate:function(e,t){clearInterval(r);var i=100,a=t,o="",l="",s="",n=0;o="last"==e?document.body.scrollHeight-document.body.scrollTop:e-document.body.scrollTop,l=a/i,s=o/i,s>0&&s<1&&(s=1);var r=setInterval(function(){Math.abs(e-document.body.scrollTop)<Math.max(10,Math.abs(o/50))?(document.body.scrollTop=e,clearInterval(r)):(document.body.scrollTop+=s,n++),n>200&&clearInterval(r)},l)},initFlyTop:function(){var e=this;e.J_fly_top=$("#flyTop"),e.J_fly_top.on("touchstart",function(){e.J_fly_top.css({opacity:".8"})}),e.J_fly_top.on("touchend",function(){e.J_fly_top.css({opacity:"1"})}),e.J_fly_top.on("tap",function(){e.scrollAnimate(0,1e3)}),$(window).bind("scroll",function(){$(window).scrollTop()>$(window).height()?e.J_fly_top.css({display:"block"}):e.J_fly_top.css({display:"none"})})},myyposition:function(e){var t=this;e.on("tap","li",function(){if(1==$(this)[0].value)t.scrollAnimate(t.location1.offset().top,500);else if(2==$(this)[0].value)t.scrollAnimate(t.location2.offset().top+5,500);else if(3==$(this)[0].value)if(0==t.bingo){t.bingo=1;var e=setTimeout(function(){t.scrollAnimate(t.location3.offset().top,500),clearTimeout(e)},400)}else t.scrollAnimate(t.location3.offset().top,500);else if(4==$(this)[0].value)if(0==t.bingo){t.bingo=1;var e=setTimeout(function(){t.scrollAnimate(t.location4.offset().top,500),clearTimeout(e)},400)}else t.scrollAnimate(t.location4.offset().top,500);else 5==$(this)[0].value&&t.scrollAnimate(0,500)})},blockPuzzle:function(){var e=this,i=0,a=0;if(e.J_blockPuzzle.on("click",function(o){return""==XIANGQU.userId?(e.login(),!1):void e.blockPuzzleAjax(t.bindPhone,"",function(t){if(t)if(200==t.code){if(i=t.data-0,e.userCards)for(var o=0;o<e.userCards.length;o++)e.userCards[o]==i&&(a=1);i+=1,1==a?alert("你翻到了重复的"+i+"号牌！"):0==a&&alert("恭喜你翻到了"+i+"号牌！"),e.J_blockPuzzle.find("a").eq(1).css("display","block"),e.J_blockPuzzle.find("a").eq(0).css("display","none"),e.J_blockPuzzleNum.find("li").eq(t.data).addClass("li-opacity"),e.J_blockPuzzle.off("click"),alert("请将此页面分享给你的好友，即可让好友帮你一起翻牌哟~")}else alert(t.msg)})}),e.J_blockPuzzleQ.on("click",function(o){return""==XIANGQU.userId?(e.login(),!1):void e.blockPuzzleAjax(t.bindPhone,"",function(t){if(t)if(200==t.code){if(i=t.data-0,e.userCards)for(var o=0;o<e.userCards.length;o++)e.userCards[o]==i&&(a=1);i+=1,1==a?alert("你翻到了重复的"+i+"号牌！"):0==a&&alert("恭喜你翻到了"+i+"号牌！"),e.J_blockPuzzle.find("a").eq(1).css("display","block"),e.J_blockPuzzle.find("a").eq(0).css("display","none"),e.J_blockPuzzleNum.find("li").eq(t.data).addClass("li-opacity"),e.J_blockPuzzle.off("click"),alert("请将此页面分享给你的好友，即可让好友帮你一起翻牌哟~")}else alert(t.msg)})}),e.userCards){for(var o=0;o<e.userCards.length;o++)e.J_blockPuzzleNum.find("li").eq(e.userCards[o]).addClass("li-opacity");e.selfUserCard&&(e.J_blockPuzzle.find("a").eq(1).css("display","block"),e.J_blockPuzzle.find("a").eq(0).css("display","none"),e.J_blockPuzzle.off("click"))}},blockPuzzleAjax:function(e,t,i,a){$.ajax({url:e,type:"post",data:t,dataType:"json",success:function(e){i&&i(e)},complete:function(){a&&a()}})},blockPuzzleShare:function(){var e=this;e.J_blockPuzzleShare.on("click",function(){e.J_shareOpacity.css("display","block")}),e.J_shareOpacity.on("click",function(){$(this).css("display","none")}),e.J_blockPuzzleApp.on("click",function(){window.location.assign("xiangqu://share")})},ChoicenessListAjax:function(){var e=this;e.J_choicenessList.on("click","li",function(t){$(this)&&(e.productAjax($(this).val()),e.J_blockPuzzleShare.length>0&&(e.storage.sNum=$(this).val()))})},GiftBag:function(){var e=this;e.J_giftBag.on("click",function(i){return""==XIANGQU.userId?(e.login(),!1):void e.blockPuzzleAjax(t.giftBag,"94",function(t){200==t.code?(e.J_shareOpacityA.css("display","block"),e.J_shareOpacityA.on("click",function(){e.J_shareOpacityA.css("display","none"),e.myposition.find("li").eq(2).trigger("tap")})):700==t.code?(alert(t.msg),e.myposition.find("li").eq(2).trigger("tap")):alert(t.msg)})})},countdownagain:function(){var e=this,t=new Date;if(e.todayLeftTimeHours>9){e.todayLeftTime=e.limitData[0][0].startTime-t.getTime(),e.hours=10;for(var i=0;i<e.J_date_li.length;i++)e.J_date_li.eq(i).find(".date_time").html("还未开始"),e.J_show_img_wrap.find("a").eq(i).removeClass("J_product_link")}else t.getHours()<10||t.getHours()>=21?(e.todayLeftTime=e.limitData[0][0].startTime-t.getTime(),e.J_show_img_wrap.find("a").eq(0).addClass("J_product_link").removeClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).addClass("J_product_link").removeClass("limitClose"),e.J_show_img_wrap.find("a").eq(2).addClass("J_product_link").removeClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("10:00"),e.J_date_li.eq(1).find(".date_time").html("13:00"),e.J_date_li.eq(2).find(".date_time").html("16:00"),e.hours=10):10<=t.getHours()&&t.getHours()<13?(e.todayLeftTime=e.limitData[1][0].startTime-t.getTime(),e.hours=13,e.J_date_li.eq(1).trigger("click"),11<=t.getHours()&&t.getHours()<13&&(e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"))):13<=t.getHours()&&t.getHours()<16?(e.todayLeftTime=e.limitData[2][0].startTime-t.getTime(),e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.hours=16,e.J_date_li.eq(2).trigger("click"),14<=t.getHours()&&t.getHours()<16&&(e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.J_date_li.eq(1).find(".date_time").html("秒杀结束"))):16<=t.getHours()&&t.getHours()<19?(e.todayLeftTime=e.limitData[3][0].startTime-t.getTime(),e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.J_date_li.eq(1).find(".date_time").html("秒杀结束"),e.hours=19,e.J_date_li.eq(3).trigger("click"),17<=t.getHours()&&t.getHours()<19&&(e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(2).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.J_date_li.eq(1).find(".date_time").html("秒杀结束"),e.J_date_li.eq(2).find(".date_time").html("秒杀结束"))):19<=t.getHours()&&t.getHours()<21&&(e.todayLeftTime=e.limitData[4][0].startTime-t.getTime(),e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(2).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.J_date_li.eq(1).find(".date_time").html("秒杀结束"),e.J_date_li.eq(2).find(".date_time").html("秒杀结束"),e.hours=21,e.J_date_li.eq(4).trigger("click"),20<=t.getHours()&&t.getHours()<21&&(e.J_show_img_wrap.find("a").eq(0).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(1).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(2).removeClass("J_product_link").addClass("limitClose"),e.J_show_img_wrap.find("a").eq(3).removeClass("J_product_link").addClass("limitClose"),e.J_date_li.eq(0).find(".date_time").html("秒杀结束"),e.J_date_li.eq(1).find(".date_time").html("秒杀结束"),e.J_date_li.eq(2).find(".date_time").html("秒杀结束"),e.J_date_li.eq(3).find(".date_time").html("秒杀结束")));e.todayLeftTime<0&&(e.todayLeftTime=0);for(var i=0;i<e.limitData.length;i++)""==e.limitData[i][0].image||null==e.limitData[i][0].image?e.J_show_img_wrap.children("a").eq(i).data("id",e.limitData[i][0].productId):e.J_show_img_wrap.children("a").eq(i).data("id",e.limitData[i][0].productId).children("img").attr("src",e.limitData[i][0].image),""==e.limitData[i][0].subtitle||null==e.limitData[i][0].subtitle?e.J_date_li.children(".date_product").eq(i).html("想去"):e.J_date_li.children(".date_product").eq(i).html(e.limitData[i][0].subtitle)},countdownstatus:function(){var e=this,i=0,a=new Date;e.blockPuzzleAjax(t.limit,"",function(t){t&&(200==t.code?t.data&&(e.limitData=t.data,i=e.limitData[0][0].startTime-a.getTime(),e.todayLeftTimeHours=Math.floor(i/1e3/60/60)>9?Math.floor(i/1e3/60/60):"0"+Math.floor(i/1e3/60/60),e.countdown(),e.countdownagain()):alert(t.msg))})},countdown:function(){var e=this,t=0,i=0,a=0;e.todayLeftTime-=1e3;var o=e.todayLeftTime;o>0?(t=Math.floor(o/1e3/60/60)>9?Math.floor(o/1e3/60/60):"0"+Math.floor(o/1e3/60/60),o-=3600*Math.floor(o/1e3/60/60)*1e3,i=Math.floor(o/1e3/60)>9?Math.floor(o/1e3/60):"0"+Math.floor(o/1e3/60),o-=60*Math.floor(o/1e3/60)*1e3,a=Math.floor(o/1e3)>9?Math.floor(o/1e3):"0"+Math.floor(o/1e3),$("#J_seckill_time_com").html("距离<span>"+e.hours+'</span>点开场&nbsp;还有<span class="seckill-time-clock">'+t+'</span><b>:</b><span class="seckill-time-clock">'+i+'</span><b>:</b></><span class="seckill-time-clock">'+a+"</span>"),e.todayLeftTimeHours=t):e.countdownagain()},commodityPosition:function(){var e=this;document.body.scrollTop=e.storage.sTop,e.J_body.on("touchend",function(){e.storage.getItem("sTop")||e.storage.setItem("sTop",0),e.storage.sTop=$(window).scrollTop()})},AutoScrollCon:function(){var e=this;e.blockPuzzleAjax(t.puzzle,"{page: 0,size:'10',}",function(t){if(t)if(200==t.code){_html="";for(var i=0,a=t.data.length;i<a;i++)_html+='<li class="clear"><img src="'+t.data[i].avatarPath+'" alt=""/><p class="notice-div-con"  target="_blank"><span>'+t.data[i].nick+'</span>翻你牌子啦</p><p class="notice-div-date">'+t.data[i].createdAtStr+"</p></li>";0==t.data.length&&e.J_noticeDiv.css("display","none"),e.J_noticeDiv.find("ul").eq(0).html(_html),t.data.length>3&&setInterval(function(){e.AutoScroll(e.J_noticeDiv)},3e3)}else alert(t.msg)})},AutoScroll:function(e){e.find("ul").eq(0).addClass("J_animation");var t=setTimeout(function(){e.find("ul").eq(0).css({marginTop:"0"}).removeClass("J_animation").find("li").eq(0).appendTo(e.find("ul").eq(0)),clearTimeout(t)},2500)},date_img_table_left:function(){var e=this,t=e.data_tab_change_nth();e.J_date_li.removeClass("current"),e.J_show_img.removeClass("show_img"),t>3?(e.J_date_li.eq(0).addClass("current"),e.J_show_img.eq(0).addClass("show_img")):(e.J_date_li.eq(t+1).addClass("current"),e.J_show_img.eq(t+1).addClass("show_img"))},date_img_table_right:function(){var e=this,t=e.data_tab_change_nth();e.J_date_li.removeClass("current"),e.J_show_img.removeClass("show_img"),t<1?(e.J_date_li.eq(4).addClass("current"),e.J_show_img.eq(4).addClass("show_img")):(e.J_date_li.eq(t-1).addClass("current"),e.J_show_img.eq(t-1).addClass("show_img"))},date_tab_change:function(){var e=this;e.J_date_li.on("click",function(){var t=e.data_tab_change_nth(),i=$(this).index();e.J_date_li.removeClass("current"),e.J_show_img.removeClass("show_img"),e.J_date_li.eq(t).removeClass("current"),e.J_show_img.eq(t).removeClass("show_img"),$(this).addClass("current"),e.J_show_img.eq(i).addClass("show_img")})},data_tab_change_nth:function(){for(var e=this,t=0,i=0;i<e.J_date_li.length;i++)e.J_date_li.eq(i).hasClass("current")&&(t=i);return t}};$(function(){new FastClick(document.body),i.init()})}(Zepto);