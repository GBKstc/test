!function(){var o={bindPhone:"/activity/twoAnn/getTicket ",giftBag:"/activity/twoAnn/coupon/grant"},n={init:function(){var o=this;o.bingo=0,o.blockPuzzleNum=0,o.J_body=$("body"),""==XIANGQU.userId||(o.userCards=userCards||[],o.selfUserCard=selfUserCard),o.toUser={},o.J_banner_image=document.querySelector("#bannerImage"),o.J_load_wrap=document.querySelector("#loadWrap"),o.J_error_wrap=$(".J_error_wrap"),o.loginUrl="http://"+window.location.host+"/login/wap/login.html",o.J_blockPuzzle=$("#J_blockPuzzle"),o.J_blockPuzzleQ=$("#J_blockPuzzleQ"),o.J_blockPuzzleNum=$("#J_blockPuzzleNum"),o.SMSTimer=null,o.J_detail=$("body"),o.J_bindPhoneBox=o.J_detail.find(".J_bindPhoneBox"),o.initBanner(),o.eventHanding(),o.blockPuzzle()},initBanner:function(){var o=this,n=o.J_banner_image.getAttribute("data-bannerSrc"),t=new Image;t.onload=function(){o.J_banner_image.setAttribute("src",n),o.J_load_wrap.style.display="none"},t.src=n},eventHanding:function(){var o=this;o.J_body.on("tap",".J_product_link",function(){o.productlinkUrl($(this).attr("data-id"))}),o.J_body.on("tap",".J_slide_banner",function(){location.href=$(this).attr("data-url")})},productlinkUrl:function(o){var n=this,t="";n.isApp?(t="http://www.xiangqu.com/product/detail?id="+o+"&isApp=1&spm=16.09.22",window.navigator.userAgent.toLocaleLowerCase().indexOf("android")>-1&&(t="xiangqu://"+location.host+"/product/detail?id="+o+"&isApp=1&spm=16.09.22")):t="/product/detail?id="+o+"&spm=16.09.22",window.location.href=t},login:function(){var o=this;""!=o.loginUrl?o.loginUrl.indexOf("http://")>=0?location.href=o.loginUrl+"?redirectUrl="+location.href:location.href=o.loginUrl:o.error_init("请重新登录～")},error_init:function(o){var n=this;n.J_error_wrap.find(".J_error_div").empty().append(o),n.J_error_wrap.css({display:"block"});var t=setInterval(function(){n.J_error_wrap.css({display:"none"}),n.J_error_wrap.find(".J_error_div").empty(),clearInterval(t)},1e3)},initFlyTop:function(){var o=this;o.J_fly_top=$("#flyTop"),o.J_body.on("touchstart",function(){o.J_fly_top.css({opacity:".8"})}),o.J_body.on("touchend",function(){o.J_fly_top.css({opacity:"1"})}),o.J_fly_top.on("tap",function(){o.scrollAnimate(0,1e3)}),$(window).bind("scroll",function(){$(window).scrollTop()>$(window).height()?o.J_fly_top.css({display:"block"}):o.J_fly_top.css({display:"none"})})},getToUser:function(){var o,n,t=this,e=location.href,i=e.indexOf("?");e=e.substr(i+1);for(var r=e.split("&"),l=0;l<r.length;l++)i=r[l].indexOf("="),i>0&&(o=r[l].substring(0,i),n=r[l].substr(i+1),t.toUser[o]=n)},blockPuzzle:function(){var n=this,t=0,e=0;if(n.J_blockPuzzle.find("a").eq(0).on("click",function(i){return""==XIANGQU.userId?(n.login(),!1):(n.getToUser(),void n.blockPuzzleAjax(o.bindPhone,n.toUser,function(o){if(o)if(200==o.code){if(t=o.data-0,n.userCards)for(var i=0;i<n.userCards.length;i++)n.userCards[i]==t&&(e=1);t+=1,1==e?alert("你翻到了重复的"+t+"号牌！"):0==e&&alert("恭喜你翻到了"+t+"号牌！"),n.J_blockPuzzleNum.find("li").eq(o.data).addClass("li-opacity"),n.J_blockPuzzle.off("click"),alert("请将此页面分享给你的好友，即可让好友帮你一起翻牌哟~")}else 3e3==o.code?(alert(o.msg),n.J_blockPuzzle.off("click")):alert(o.msg)}))}),n.J_blockPuzzleQ.on("click",function(i){return""==XIANGQU.userId?(n.login(),!1):(n.getToUser(),void n.blockPuzzleAjax(o.bindPhone,n.toUser,function(o){if(o)if(200==o.code){if(t=o.data-0,n.userCards)for(var i=0;i<n.userCards.length;i++)n.userCards[i]==t&&(e=1);t+=1,1==e?alert("你翻到了重复的"+t+"号牌！"):0==e&&alert("恭喜你翻到了"+t+"号牌！"),n.J_blockPuzzleNum.find("li").eq(o.data).addClass("li-opacity"),n.J_blockPuzzle.off("click"),alert("请将此页面分享给你的好友，即可让好友帮你一起翻牌哟~")}else 3e3==o.code?(alert(o.msg),n.J_blockPuzzle.off("click")):alert(o.msg)}))}),n.userCards){for(var i=0;i<n.userCards.length;i++)n.J_blockPuzzleNum.find("li").eq(n.userCards[i]).addClass("li-opacity");n.selfUserCard}},blockPuzzleAjax:function(o,n,t,e){$.ajax({url:o,type:"post",data:n,dataType:"json",success:function(o){t&&t(o)},complete:function(){e&&e()}})},GiftBag:function(){var n=this;n.J_giftBag.on("click",function(t){return""==XIANGQU.userId?(n.login(),!1):void n.blockPuzzleAjax(o.giftBag,"94",function(o){o&&alert(o.msg)})})}};$(function(){new FastClick(document.body),n.init()})}(Zepto);